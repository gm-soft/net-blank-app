<app-page-header>
  <div class="app-page-header-label">
    <b>{{ project?.fullName }}</b
    >'s fixed costs
  </div>
</app-page-header>

<div class="container mt-3" *ngIf="project != null">
  <div class="d-flex justify-content-between mb-3">
    <div class="d-inline-block">
      <app-go-back-button></app-go-back-button>
      <a routerLink="/projects/{{ project.id }}" class="btn btn-outline-secondary ml-1">
        Project page
      </a>
    </div>
  </div>
  <div class="card">
    <ul class="list-group list-group-flush">
      <li *ngIf="hasExistingItems; else noFixedCosts" class="list-group-item">
        <div class="row">
          <div class="col-md-3">
            <label>Title</label>
          </div>
          <div class="col-md-5">
            <label>Description</label>
          </div>
          <div class="col-md-4">
            <label>Cost</label>
          </div>
        </div>
      </li>
      <li class="list-group-item" *ngFor="let fixedCostGroupItem of fixedCostGroups.controls; index as index">
        <form [formGroup]="fixedCostGroupItem">
          <div class="row">
            <div class="col-md-3">
              <div class="input-group">
                <input class="form-control" autocomplete="off" formControlName="title" placeholder="Title" />
              </div>
            </div>
            <div class="col-md-5">
              <div class="input-group">
                <input
                  class="form-control"
                  autocomplete="off"
                  formControlName="description"
                  placeholder="Description"
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="input-group">
                <input
                  class="form-control"
                  autocomplete="off"
                  formControlName="cost"
                  appOnlyNumber
                  placeholder="Cost"
                />
                <div *ngIf="fixedCostGroupItem.enabled" class="input-group-append">
                  <button
                    class="btn btn-outline-success"
                    *ngIf="fixedCostGroupItem.enabled"
                    title="Save"
                    (click)="updateFixedCost(fixedCostGroupItem)"
                  >
                    Save
                  </button>
                  <button
                    class="btn btn-outline-danger"
                    *ngIf="fixedCostGroupItem.enabled"
                    title="Cancel"
                    (click)="cancel()"
                  >
                    <i class="fa fa-lg fa-times"></i>
                  </button>
                </div>
                <div *ngIf="!fixedCostGroupItem.enabled && projectExtended?.isActive()" class="input-group-append">
                  <button class="btn btn-outline-primary ml-1" (click)="enableControls(index)">
                    Edit
                  </button>
                </div>
                <div class="input-group-append" *ngIf="projectExtended?.isActive()">
                  <button
                    type="button"
                    class="btn btn-outline-danger"
                    (click)="deleteFixedCost(fixedCostGroupItem)"
                    title="Remove fixed cost"
                  >
                    <i class="far fa-trash-alt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </li>
    </ul>
  </div>
  <div class="card mt-3" *ngIf="projectExtended?.isActive()">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <form
          class="mt-3"
          *ngIf="fixedCostForm != null"
          [formGroup]="fixedCostForm"
          (ngSubmit)="onFixedCostFormAddSubmit()"
        >
          <div class="row">
            <div class="col-md-3">
              <div class="input-group">
                <input type="text" class="form-control" formControlName="title" placeholder="Title" />
              </div>
              <small class="form-text text-muted">Field is required</small>
            </div>

            <div class="col-md-5">
              <div class="input-group">
                <input type="text" class="form-control" formControlName="description" placeholder="Description" />
              </div>
              <small class="form-text text-muted">Field is required</small>
            </div>

            <div class="col-md-4">
              <div class="input-group">
                <input type="text" class="form-control" formControlName="cost" appOnlyNumber placeholder="Cost" />

                <div class="input-group-append">
                  <button class="btn btn-outline-primary" type="submit">Add</button>
                </div>
              </div>
              <small class="form-text text-muted">Field is required</small>
            </div>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

<ng-template class="container mt-3" #noFixedCosts>
  <div>No fixed costs</div>
</ng-template>
<app-confirm-dialog *ngIf="confirmDeletionMessage != null" [message]="confirmDeletionMessage"></app-confirm-dialog>
