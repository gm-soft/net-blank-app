<div class="">
  <div class="">
    <h5>Participants: {{ activeParticipantsCount }}</h5>
  </div>

  <div class="mt-3">
    <div class="">
      <table class="table table-striped table-bordered table-hover" *ngIf="participants.length > 0; else noOneBlock">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th>Employee</th>
            <th>Role</th>
            <th>Utilization</th>
            <th>From</th>
            <th>To</th>
            <th *ngIf="showActiveStatusLabel">Status</th>
            <th *ngIf="showActions || showRemoveFromDatabase">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let participant of participants; let i = index">
            <th scope="row">{{ i + 1 }}</th>
            <td>
              <a routerLink="/users/{{ participant.employeeId }}">{{ participant.fullName }}</a>
            </td>
            <td>{{ participant.role }}</td>
            <td class="w-15">
              <div *ngIf="participant.isManager">{{ participant.utilization }}%</div>
              <div *ngIf="!participant.isManager">
                <div class="input-group">
                  <input
                    type="tel"
                    name="utilization"
                    appOnlyNumber
                    [(ngModel)]="participant.utilization"
                    class="form-control"
                    [disabled]="!participant.isEditable"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text">%</span>
                  </div>
                </div>
                <div class="my-1" *ngIf="participant.checkUtilization()">
                  <p class="alert alert-danger small">
                    Max 100, min 10.
                  </p>
                </div>
              </div>
            </td>
            <td>{{ participant.from | date: 'yyyy-MM-dd' }}</td>
            <td>
              <div *ngIf="participant.isManager">
                {{ participant.toAsDate | date: 'yyyy-MM-dd' }}
              </div>
              <div *ngIf="!participant.isManager">
                <div class="input-group">
                  <input
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    autocomplete="off"
                    name="to"
                    [(ngModel)]="participant.to"
                    ngbDatepicker
                    [disabled]="!participant.isEditable"
                    #endDatePicker="ngbDatepicker"
                    required
                  />
                  <div *ngIf="participant.isEditable" class="input-group-append">
                    <button
                      class="btn btn-outline-secondary calendar"
                      (click)="endDatePicker.toggle()"
                      type="button"
                      title="Pick"
                    >
                      <i class="far fa-calendar-alt"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="my-1" *ngIf="participant.checkDate()">
                <p class="alert alert-danger small">
                  <strong>To date should be greater than From date.</strong><br />
                  Please double-check the from and to dates.
                </p>
              </div>
            </td>
            <td *ngIf="showActiveStatusLabel">
              <p class="badge badge-success" *ngIf="!participant.isInactive && !participant.comingSoon()">
                Active
              </p>
              <p class="badge badge-warning" *ngIf="participant.isInactive">Inactive</p>
              <p class="badge badge-danger" *ngIf="participant.comingSoon()">Coming Soon</p>
            </td>
            <td *ngIf="showActions || showRemoveFromDatabase">
              <div class="d-inline-block" *ngIf="participant.isEditable">
                <button
                  class="btn btn-sm btn-success"
                  *ngIf="participant.isEditable"
                  title="Save"
                  (click)="saveParticipant(participant)"
                >
                  <i class="far fa-save"></i>
                </button>

                <button
                  class="btn btn-sm btn-outline-secondary ml-1 mr-1"
                  *ngIf="participant.isEditable"
                  title="Cancel"
                  (click)="participant.cancel(project)"
                >
                  <i class="fa fa-lg fa-times"></i>
                </button>
              </div>

              <button
                class="btn btn-sm btn-outline-secondary"
                *ngIf="!participant.isEditable && !participant.isInactive && !participant.isManager"
                (click)="participant.isEditable = true"
                title="Edit participant's 'To' date"
              >
                <i class="fa fa-pen"></i>
              </button>

              <button
                *ngIf="!participant.isInactive && !participant.isManager"
                type="button"
                class="btn btn-sm btn-warning ml-1"
                (click)="deleteParticipant(participant)"
                title="Make the user participation outdated"
              >
                <i class="fas fa-archive"></i>
              </button>

              <button
                *ngIf="participant.isInactive && showRemoveFromDatabase"
                type="button"
                class="btn btn-sm btn-outline-danger ml-1"
                (click)="removeEmployeeFromDatabase(participant)"
                title="Remove project participant from database"
              >
                <i class="far fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #noOneBlock>
      No one participant found
    </ng-template>
  </div>
</div>

<app-confirm-dialog *ngIf="confirmDeletionMessage != null" [message]="confirmDeletionMessage"></app-confirm-dialog>
